<?php
  require_once dirname(__FILE__) . '/asset/inc/function.php';

?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="<?=__ROOT__()?>asset/img/AKS-Emblem.png?v=1&load=<?=time()?>">
  <script type="module" src="<?=__ROOT__()?>asset/js/flo3fwf.js?load=<?=time()?>"></script>
  <link rel="stylesheet" href="<?=__ROOT__()?>asset/css/all.min.css">
  <title>Admin Login - <?=__SITE_NAME__?></title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    <meta name="description" content="Admin Login - <?=__SITE_NAME__?> ">
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta name="theme-color" content="#00703c">
    <meta name="keywords" content="Admin, Login, <?=__SITE_NAME__?>">
    <meta name="author" content="<?=__SITE_NAME__?>">
    <meta name="robots" content="index, follow">
    <!-- robots invite -->
    <link rel="canonical" href="<?=__ROOT__()?>staff-ms/login.html">
    <meta property="og:title" content="Admin Login - <?=__SITE_NAME__?>">
    <meta property="og:description" content="Admin Login - <?=__SITE_NAME__?>">
    <meta property="og:image" content="<?=__ROOT__()?>asset/img/AKS-Emblem.png?v=1&load=<?=time()?>">
    <meta property="og:url" content="<?=__ROOT__()?>staff-ms/login.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Admin Login - <?=__SITE_NAME__?>">
    <meta name="twitter:description" content="Admin Login - <?=__SITE_NAME__?>">
    <meta name="twitter:image" content="<?=__ROOT__()?>asset/img/AKS-Emblem.png?v=1&load=<?=time()?>">
    <meta name="twitter:site" content="@YourTwitterHandle">
    <meta name="twitter:creator" content="@YourTwitterHandle">
    <meta name="apple-mobile-web-app-title" content="<?=__SITE_NAME__?>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="<?=__SITE_NAME__?>">
    <meta name="msapplication-TileColor" content="#00703c">
    <meta name="msapplication-TileImage" content="<?=__ROOT__()?>asset/img/AKS-Emblem.png?v=1&load=<?=time()?>">

    <meta name="google-site-verification" content="your-google-site-verification-code">
    <meta name="yandex-verification" content="your-yandex-verification-code">
    <meta name="bing-site-verification" content="your-bing-site-verification-code">
    <meta name="pinterest-site-verification" content="your-pinterest-site-verification-code">
    <meta name="ahrefs-site-verification" content="your-ahrefs-site-verification-code">
    <meta name="baidu-site-verification" content="your-baidu-site-verification-code">
    <link rel="stylesheet" href="<?=__ROOT__()?>asset/css/moj-jaldkkfkasff-fssa.css?v=1&load=<?=time()?>">
    <!-- <script type="module" src="<?=__ROOT__()?>asset/js/lndfaf343ffsda-module.js?load=<?=time()?>"></script> -->
<style>
  .__load__:disabled{
    background: gray;
  }
</style>
</head>
<body>
  <div class="login-container" id="login-container">
    <h2>User Login</h2>
    <form action="login.php" method="POST">
        <div class="form-group">
            <img class="__logo__" src="<?=__ROOT__()?>/asset/img/AKS-Emblem.png" alt="Logo" srcset="<?=__ROOT__()?>/asset/img/AKS-Emblem.png">
        </div>
      <div class="form-group">
        <label for="username">Email</label>
        <input type="email" id="username" name="username" placeholder="Enter email" required autocomplete="email">
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Enter password" required>
      </div>
      <button type="button" class="login-btn __load__">Login</button>
      <div class="extra-links">
        <p><a href="<?=__ROOT__()?>reset-password/?u=1&v=<?=password_hash(__PWD_RESET_KEY__, PASSWORD_BCRYPT)?>">Forgot Password?</a></p>
      </div>
    </form>
  </div>

  <?php

   // echo password_hash("09069053009@@AAaa", PASSWORD_BCRYPT);
  ?>

  <script type="module">
    import * as loader from './asset/js/load';
    import { selector, __ROOT__, showToast } from './asset/js/flo3fwf';
    import validateInput from './asset/js/validateInput';

    const isAuth = await loader.loadGet('asset/apis/auth/IsAuth.php', '', '');
  // console.log(selector('.__load__'));


    if ('logged_in' in isAuth && isAuth.logged_in) {
          const user = isAuth.user.role;
        window.location.replace(__ROOT__ + await loader.path(user));
      // console.log(user);
      // console.log(await loader.path(user))
      // return;
    }

  // console.log(loader.default().load('asset/apis/auth/IsAuth.php', '', false));

    selector('.__load__').addEventListener('click', async(e) => {
      e.preventDefault();
      // alert('Login clicked');
      let email     = selector('#username')?.value ?? null;
      let password  = selector('#password')?.value ?? null;
      let clickable = selector('.__load__');

      if(!validateInput(email, 'email')) return showToast('Error: Please Enter a valid Email Adress', 'error');
      // if(!validateInput(password, 'password')) return showToast('Error: Please Enter a valid password', 'error');

        clickable.innerHTML = 'Loading... <i class="fas fa-spin fa-spinner"></i>';
        clickable.disabled = true;


  const LoginRequest = await loader.default('asset/apis/auth/', function(){

        }, {email, password});

        console.log(LoginRequest);
        if(!LoginRequest.success){clickable.disabled=false;clickable.innerHTML='Login'; return showToast(LoginRequest.message, 'error')}

        showToast(`${LoginRequest.message}, Please wait while system redirect you do dashboard`, 'success');

        setTimeout(async() => {
          // window.location.replace(__ROOT__ + LoginRequest.redirect);
          window.location.replace(__ROOT__ + await loader.path(LoginRequest.user.role));
        }, 2000);
        
    })

    

  </script>
  <script src="<?=__ROOT__()?>asset/js/all.min.js"></script>
</body>
</html>
